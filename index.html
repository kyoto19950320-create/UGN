<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>UGN Ethical Assessment</title>

<style>
  :root{
    --bg:#0b0f14;
    --panel:#101824;
    --border:#223047;
    --text:#e8eef6;
    --muted:#a7b3c2;
    --accent:#7fd1ff;
  }
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family: system-ui,-apple-system,"Noto Sans JP","Yu Gothic",sans-serif;
  }
  .wrap{max-width:900px;margin:auto;padding:16px;}
  .card{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:16px;
    padding:16px;
  }
  img{width:100%;object-fit:contain;display:block;border-radius:12px;}
  .hero,.qimg,.resultImg{
    max-height:260px;
    background:#fff;
  }
  @media(min-width:768px){
    .hero,.qimg,.resultImg{max-height:340px;}
  }
  .title{font-size:18px;font-weight:800;letter-spacing:.02em;}
  .subtitle{font-size:14px;color:var(--muted);margin-top:4px;}
  .muted{color:var(--muted);font-size:13px;line-height:1.6;}
  .choices{margin-top:14px;display:grid;gap:10px;}
  .choice{
    padding:12px;
    border-radius:12px;
    border:1px solid var(--border);
    background:var(--bg);
    color:var(--text);
    text-align:left;
    line-height:1.4;
  }
  .choice.selected{
    border-color:var(--accent);
    background:#122033;
  }
  .btn{
    margin-top:14px;
    width:100%;
    padding:14px;
    border-radius:14px;
    border:1px solid var(--border);
    background:#16263a;
    color:var(--text);
    font-weight:800;
    letter-spacing:.02em;
  }
  .btn:disabled{opacity:.4}
  .code{
    margin-top:12px;
    padding:10px;
    border:1px dashed var(--border);
    border-radius:10px;
    font-size:13px;
    color:#c6d2e1;
    line-height:1.5;
    white-space:pre-wrap;
    word-break:break-word;
  }
  .summary{
    margin-top:12px;
    line-height:1.7;
    white-space:pre-line;
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .pill{
    border:1px solid var(--border);
    border-radius:999px;
    padding:6px 10px;
    font-size:12px;
    color:#c6d2e1;
    background:#0f1723;
  }
  .err{
    margin-top:10px;
    padding:10px;
    border:1px solid #5a2b2b;
    background:#2a1414;
    border-radius:12px;
    font-size:13px;
    line-height:1.6;
  }
</style>
</head>

<body>
<div class="wrap"><div id="view"></div></div>

<script>
/* =======================
   基本設定（時間）
======================= */
const QUICK = 5000;   // 5秒以内＝即答
const DEEP  = 10000;  // 10秒超＝深逡巡

/* 10分類キー（ファイル名と一致） */
const TYPE_KEYS = [
  "Order","Delegator","Utilitarian","Altruist","Bearer",
  "Role","Impulse","Avoider","Anchor","Observer"
];

/* 表示データ（UGN総評） */
const TYPE_DATA = {
  Order:{ jp:"秩序優先型", title:"秩序維持を基準に置く判断", summary:
`命令系統・規範を優先し、現場の混乱を最小化する傾向が強い。
組織運用上の安定戦力となる一方、上位判断が誤っていた場合でも従い続けるリスクを内包する。
運用上は「明確な規則」と「責任所在」を提示すると性能が伸びる。`},
  Delegator:{ jp:"責任限定型", title:"判断を委任する判断", summary:
`判断を上位に委ねることで誤判断を避け、自己の限界を管理する傾向が強い。
指揮不在・通信断の局面で判断停止に陥りやすい点に注意が必要。
運用上は代替プロトコルと、複数の指揮経路を準備することが望ましい。`},
  Utilitarian:{ jp:"功利計算型", title:"結果と効率を優先する判断", summary:
`結果・人数・成功率を基準に、最適化に寄せた判断ができる。
作戦立案・参謀適性が高い一方、「切り捨て」の判断に慣れすぎると現場の信頼を失う可能性がある。
運用上は情緒面の緩衝材となる同伴者の配置が有効。`},
  Altruist:{ jp:"献身行動型", title:"目の前の命に引き寄せられる判断", summary:
`救助・保護行動に出やすく、現場での初動に強い。
ただし救えなかった経験を強く内面化しやすく、自責による自壊リスクが高い。
運用上はケア導線と「失敗を個人の罪にしない」評価設計が重要。`},
  Bearer:{ jp:"自己責任型", title:"背負える範囲で線引きする判断", summary:
`「自分が責任を取れるか」を基準に判断する傾向が強い。
現実的で信頼されやすい一方、限界超過時の折れ方が急激になりうる。
運用上は負荷上限の明文化と休息管理が有効。`},
  Role:{ jp:"役割遵守型", title:"職務と配属を優先する判断", summary:
`立場・役目を優先し、感情と判断を切り分ける傾向が強い。
組織的に扱いやすい一方、人間関係の希薄化や誤解（冷淡視）を招く可能性がある。
運用上は任務定義と交代基準を明確にすること。`},
  Impulse:{ jp:"直感衝動型", title:"直感で踏み込む判断", summary:
`危機対応が速く、瞬間判断に強い。
一方で誘導・心理操作の影響を受けやすく、後付け合理化で判断が固定化される危険がある。
運用上は「止め具」になる相棒・チェック手順の同伴が望ましい。`},
  Avoider:{ jp:"熟慮回避型", title:"二択を避け第三案を探す判断", summary:
`想定外の突破口を見つけやすく、膠着局面で価値が出る。
ただし決断期限がある状況で判断不能に陥る可能性がある。
運用上は制限時間と選択枠の提示、および最後の一押し役の配置が有効。`},
  Anchor:{ jp:"依存安定型", title:"拠り所で安定する判断", summary:
`組織・誰か・仕組みに依存することで判断が安定しやすい。
依存先が崩れると急激に不安定化し、極端な判断に振れる危険がある。
運用上は依存先を単一化しない構造が望ましい。`},
  Observer:{ jp:"観測者型", title:"一歩引いて分析する判断", summary:
`状況・利害・流れを俯瞰し、情報収集と分析に強い。
当事者性が薄れやすく、責任を外部に置く癖が出る場合がある。
運用上は明確な権限と責務を与えることが重要。`}
};

/* =======================
   設問定義
   ※ map のキーは 1〜5（選択肢番号）
======================= */
const QUESTIONS = [
  {img:"q1", choices:[
    "任務を優先し、見なかったことにする",
    "最低限の救命処置だけ行う",
    "救助を最優先する",
    "上司に判断を仰ぐ",
    "状態を見て判断する"
  ], map:{
    1:["Order","Role"],
    2:["Bearer"],
    3:["Altruist"],
    4:["Delegator","Anchor"],
    5:["Observer","Utilitarian"]
  }},
  {img:"q2", choices:[
    "命令違反として制止する",
    "裏でフォローする",
    "共に行動する",
    "距離を取る",
    "同じ選択をする"
  ], map:{
    1:["Order"],
    2:["Observer"],
    3:["Altruist","Bearer"],
    4:["Delegator"],
    5:["Impulse"]
  }},
  {img:"q3", choices:[
    "秘匿する",
    "段階的に開示",
    "全て公表",
    "上に委ねる",
    "得をする者で判断"
  ], map:{
    1:["Order"],
    2:["Observer"],
    3:["Altruist"],
    4:["Delegator","Anchor"],
    5:["Utilitarian"]
  }},
  {img:"q4", choices:[
    "被害が少ない方",
    "後悔しない方",
    "役割に従う",
    "第三の可能性",
    "責任を取れる方"
  ], map:{
    1:["Utilitarian"],
    2:["Impulse"],
    3:["Role","Order"],
    4:["Avoider"],
    5:["Bearer"]
  }},
  {img:"q5", choices:[
    "隠し通す",
    "必要なら明かす",
    "身を引く",
    "組織に従う",
    "恐れていない"
  ], map:{
    1:["Anchor","Order"],
    2:["Altruist"],
    3:["Avoider","Observer"],
    4:["Delegator"],
    5:["Impulse","Utilitarian"]
  }}
];

/* =======================
   パス（ここが重要）
   GitHub Pages の /UGN/ 配下でも壊れないように "./" を使う
======================= */
const ASSET = {
  top:  "./img/top.png",
  q:    (n)=>`./img/q${n}.png`,
  type: (key)=>`./img/type/${key}.png`  // ←あなたの現状「type」単数に合わせた
};

/* キャッシュ対策（更新直後に反映されない時のため） */
const CACHE_BUST = ""; // 例: "?v=1" とか付けたければ "?v=20260115" など固定値で

/* =======================
   状態
======================= */
let step=-1;
let startedAt=0;
let selected=null;

let score={};
let qCnt=0;   // 即答
let dCnt=0;   // 逡巡
let ddCnt=0;  // 深逡巡

TYPE_KEYS.forEach(t=>score[t]=0);

const view=document.getElementById("view");

/* =======================
   便利関数
======================= */
function now(){ return performance.now(); }
function ms(){ return Math.round(now()-startedAt); }

function locationInfo(){
  return `location.href = ${location.href}\nbase = ${location.origin + location.pathname.replace(/[^/]*$/, "")}`;
}

function imgTag(src, cls, alt){
  // 画像が404でも“真っ黒で何も出ない”を避ける：onerrorでメッセージ表示
  const safeAlt = alt || "image";
  return `
    <img class="${cls}"
         src="${src + CACHE_BUST}"
         alt="${safeAlt}"
         onerror="this.style.display='none';document.getElementById('imgErr').style.display='block';document.getElementById('imgErr').textContent='画像が読み込めません：${src}';">`;
}

/* =======================
   画面
======================= */
function top(){
  view.innerHTML=`
  <div class="card">
    <div class="title">UGN ETHICAL ASSESSMENT</div>

    <div id="imgErr" class="err" style="display:none;"></div>
    ${imgTag(ASSET.top, "hero", "top")}

    <p class="muted">
      推奨：直感的に選択してください。<br>
      ※迷った時間も評価対象です。<br>
      ※次へ進むと戻れません。
    </p>

    <div class="row">
      <div class="pill">即答：${QUICK/1000}s以内</div>
      <div class="pill">深逡巡：${DEEP/1000}s超</div>
    </div>

    <button class="btn" onclick="startTest()">開始</button>

    <div class="code" style="margin-top:14px;">[診断用]\n${locationInfo()}\nTOP=${ASSET.top}</div>
  </div>`;
}

function showQ(){
  const q=QUESTIONS[step];
  const qno = step+1;

  view.innerHTML=`
  <div class="card">
    <div class="title">Question ${qno}</div>

    <div id="imgErr" class="err" style="display:none;"></div>
    ${imgTag(ASSET.q(qno), "qimg", `q${qno}`)}

    <div class="choices">
      ${q.choices.map((c,i)=>`
        <button class="choice ${selected===i?'selected':''}" onclick="pick(${i})">${c}</button>
      `).join("")}
    </div>

    <button class="btn" ${selected===null?'disabled':''} onclick="nextQ()">次へ</button>

    <div class="code">[計測] 経過=${ms()}ms / 選択=${selected===null?'未選択':(selected+1)} / 画像=${ASSET.q(qno)}</div>
  </div>`;
}

function result(){
  // 最大スコアの型
  let type = TYPE_KEYS.reduce((a,b)=> (score[a] >= score[b] ? a : b));
  // 反応傾向フラグ（即答が多いならQ優先）
  let flag = (qCnt>=3) ? "Q" : (ddCnt>=2) ? "DD" : "D";

  const d = TYPE_DATA[type];

  const code = `${type.slice(0,3).toUpperCase()}-${flag}`;

  view.innerHTML=`
  <div class="card">
    <div class="title">診断結果</div>

    <div id="imgErr" class="err" style="display:none;"></div>
    ${imgTag(ASSET.type(type), "resultImg", type)}

    <div class="title" style="margin-top:10px;">${d.jp}</div>
    <div class="subtitle">${d.title}</div>

    <div class="summary">${d.summary}</div>

    <div class="row">
      <div class="pill">Result Code：${code}</div>
      <div class="pill">即答：${qCnt}</div>
      <div class="pill">逡巡：${dCnt}</div>
      <div class="pill">深逡巡：${ddCnt}</div>
    </div>

    <div class="code">[診断用]\n結果画像=${ASSET.type(type)}\nスコア=${JSON.stringify(score)}</div>

    <p class="muted">※この画面をスクリーンショットで共有してください</p>

    <button class="btn" onclick="resetAll()">最初から</button>
  </div>`;
}

/* =======================
   ロジック
======================= */
function startTest(){
  step = 0;
  selected = null;
  qCnt = 0; dCnt = 0; ddCnt = 0;
  TYPE_KEYS.forEach(t=>score[t]=0);

  startedAt = now();
  showQ();
}

function pick(i){
  selected = i;
  showQ(); // 「選んだ後も変更できる」= 次へを押すまでは何度でも上書き
}

function nextQ(){
  const elapsed = now() - startedAt;

  // 迷い判定（回数）
  if(elapsed <= QUICK) qCnt++;
  else if(elapsed > DEEP) ddCnt++;
  else dCnt++;

  // 重み：即答だけ +2、逡巡は +1（あなたの元仕様）
  const w = (elapsed <= QUICK) ? 2 : 1;

  const q = QUESTIONS[step];
  const selectedNo = selected + 1; // 1〜5
  const adds = (q.map[selectedNo] || []);

  adds.forEach(key => { score[key] += w; });

  // 次へ（戻れない）
  step++;
  selected = null;

  if(step >= QUESTIONS.length){
    result();
    return;
  }
  startedAt = now();
  showQ();
}

function resetAll(){
  step = -1;
  selected = null;
  top();
}

/* 初期表示 */
top();
</script>
</body>
</html>
